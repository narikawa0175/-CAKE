<%= render 'admin/admins' %>

<div class="container">
 <h5><strong>注文履歴詳細</strong></h5>

 <div class="row">
  <strong>購入者</strong>
  <%= link_to admin_customer_path(@order.id) do %>
   <%= @order.customer.last_name %><%= @order.customer.first_name %>
  <% end %>
 </div>
 
 <div class="row">
  <strong>注文日</strong>
  <%= @order.created_at.strftime("%Y/%m/%d %H:%M:%S") %>
 </div>
 
 <div class="row">
  <strong>配送先</strong>
  <%= @order.address %>
 </div>
 
 <div class="row">
  <strong>支払い方法</strong>
  <%= @order.method_of_payment_i18n %>
 </div>
 
 <%= form_with model: @order,url: admin_order_path(@order.id),method: :patch do |f| %>
  <div class="row">
   <strong>注文ステータス</strong>
   <%= f.select :making_status, Order.making_statuses_i18n.invert,{} %>
   <%= f.submit "更新" %>
 <% end %>
 </div>
 
 <div class="row">
  <table class="table col-8">
   <thead>
    <tr>
     <td><strong>商品名</strong></td>
     <td><strong>税込</strong></td>
     <td><strong>数量</strong></td>
     <td><strong>小計</strong></td>
     <td><strong>製作ステータス</strong></td>
    </tr>
   </thead>
  
   <tbody>
    <% @deta.each do |data| %>
     <tr>
      <td><%= data.item.name %></td>
      <td><%= data.tax_price.to_s(:delimited) %></td>
      <td><%= data.amount %></td>
      <td><%= data.subtotal.to_s(:delimited) %></td>
      <td>
       <%= form_with model: @order_data,url: admin_order_datail_path(@order_data.id),method: :patch do |f| %>
        <%= f.select :production_status,OrderDatail.production_statuses_i18n.invert,{} %>
       <% end %>
      </td>
     </tr>
    </tbody>
   </table>
  
   <table class="col-4">
    <tbody>
     <tr>
      <td><strong>商品合計</strong></td>
      <td><%= (@total=@total+data.subtotal).to_s(:delimited) %>円</td>
     </tr>
     
     <tr>
      <td><strong>送料</strong></td>
      <td><%= @order.shipping_cost %>円</td>
     </tr>
     
     <tr>
      <td><strong>請求合計金額</strong></td>
      <td><%= (@total=@total+@order.shipping_cost).to_s(:delimited) %>円</td>
     </tr>
    </tbody>
   <% end %>
  </table>
 </div>
</div>

